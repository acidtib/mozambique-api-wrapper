const fetch=require("node-fetch"),BASE_URL="https://api.mozambiquehe.re",DIRECTORY={SEARCH_URL:BASE_URL+"/bridge?version={v}",NEWS_URL:BASE_URL+"/news?",SERVER_STATUS:BASE_URL+"/servers?",MATCH_HISTORY:BASE_URL+"/bridge?",GAME_DATA:BASE_URL+"/gamedata?"};function request(e,r){return fetch(r.replace(/\{v\}/g,e.version),{headers:e.headers}).then(function(e){return e.json()}).catch(function(e){return Promise.reject(e)})}class MozambiqueAPI{constructor(e,r=5){if(!e)throw new Error("[ERROR] mozampique-api-wrapper: API Key missing");this.apiKey=e,this.version=r,this.headers={"User-Agent":"mozambique-api-wrapper","Content-Type":"application/json",Authorization:this.apiKey}}search(e){let r;return e.player&&(r="player="+e.player),e.uid&&(r="uid="+e.uid),request(this,DIRECTORY.SEARCH_URL+"&platform="+e.platform+"&"+r)}news(e="en-us"){return request(this,DIRECTORY.NEWS_URL+"lang="+e)}server(){return request(this,DIRECTORY.SERVER_STATUS)}history(e,r){let t;return e.player&&(t="player="+e.player),e.uid&&(t="uid="+e.uid),request(this,DIRECTORY.MATCH_HISTORY+t+"&platform"+e.platform+"&history=1&action="+r)}async compare(e,r){if(!e.platform||!r.platform)throw new Error("Platform required");var t={players:[],comparedData:{}};if(e.platform==r.platform){let a;e.player&&(a=`player=${e.player},${r.player}`),e.uid&&(a=`uid=${e.uid},${r.uid}`);let i=DIRECTORY.SEARCH_URL+"&platform="+e.platform+"&"+a;t.players=await request(this,i)}else{let a;e.player&&(a="player="+e.player),e.uid&&(a="uid="+e.uid);let i,s=DIRECTORY.SEARCH_URL+"&platform="+e.platform+"&"+a;t.players[0]=await request(this,s),r.player&&(i="player="+r.player),r.uid&&(i="uid="+r.uid);let p=DIRECTORY.SEARCH_URL+"&platform="+r.platform+"&"+i;t.players[1]=await request(this,p)}return t}gamedata(e){return request(this,DIRECTORY.GAME_DATA+"type="+e)}}module.exports=MozambiqueAPI;