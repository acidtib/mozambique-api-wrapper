const fetch=require("node-fetch"),BASE_URL="https://api.mozambiquehe.re",DIRECTORY={SEARCH_URL:BASE_URL+"/bridge?version=",NEWS_URL:BASE_URL+"/news?",SERVER_STATUS:BASE_URL+"/servers?",MATCH_HISTORY:BASE_URL+"/bridge?",GAME_DATA:BASE_URL+"/gamedata?"};function request(e,r){return fetch(r,{headers:e.headers}).then(function(e){return e.json()}).catch(function(e){return Promise.reject(e)})}function sleep(e){return new Promise(r=>setTimeout(r,e))}class MozambiqueAPI{constructor(e,r=5){if(!e)throw new Error("[ERROR] mozampique-api-wrapper: API Key missing");this.apiKey=e,this.version=r,this.headers={"User-Agent":"mozambique-api-wrapper","Content-Type":"application/json",Authorization:this.apiKey}}search(e){let r;return e.player&&(r="player="+e.player),e.uid&&(r="uid="+e.uid),request(this,DIRECTORY.SEARCH_URL+this.version+"&platform="+e.platform+"&"+r)}news(e="en-us"){return request(this,DIRECTORY.NEWS_URL+"lang="+e)}server(){return request(this,DIRECTORY.SERVER_STATUS)}history(e,r){let t="";if("info"!=e){let e;r.player&&(e="player="+r.player),r.uid&&(e="uid="+r.uid),t=e+"&platform="+r.platform+"&"}return request(this,DIRECTORY.MATCH_HISTORY+t+"history=1&action="+e)}async compare(e,r){if(!e.platform||!r.platform)throw new Error("Platform required");var t={players:[],data:{trackers:[],badges:[]}};if(e.platform===r.platform){let a;e.player&&(a=`player=${e.player},${r.player}`),e.uid&&(a=`uid=${e.uid},${r.uid}`);let i=DIRECTORY.SEARCH_URL+this.version+"&platform="+e.platform+"&"+a;t.players=await request(this,i)}else{let a;e.player&&(a="player="+e.player),e.uid&&(a="uid="+e.uid);let i,s=DIRECTORY.SEARCH_URL+this.version+"&platform="+e.platform+"&"+a;t.players[0]=await request(this,s),r.player&&(i="player="+r.player),r.uid&&(i="uid="+r.uid);let o=DIRECTORY.SEARCH_URL+this.version+"&platform="+r.platform+"&"+i;t.players[1]=await request(this,o)}return t}gamedata(e){return request(this,DIRECTORY.GAME_DATA+"type="+e)}}module.exports=MozambiqueAPI;